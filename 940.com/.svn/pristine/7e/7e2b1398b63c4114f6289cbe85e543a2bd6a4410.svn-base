Fengs.add("940/user/user",function(e,t){return{init:function(){this.eventFn(),this.changeHash(),this.revise(),this.allData={};var e=t.cookie("940_COM_USER"),i=t.cookie("940_COM_PASS");(null==e||null==i)&&setTimeout(function(){layer.msg("你好，请先登录！",{time:2e3}),setTimeout(function(){window.location.href="/"},1500)},50)},revise:function(){var e=t("#edit_ul"),i=t(".sex_inp"),n=this;this.uesrData={},this.nameOff=!1,e.on("click",".revise_inp a",function(){var e=t(this).parent(),i=e.html();e.html("<input id='txtInp' class='xg_txt' type='text' />"),t("#txtInp").focus().blur(function(){if(e.html(i),""!=this.value){e.children("i").html(this.value),e.children("a").html("（修改）");var t=e.children("a").data("v");"name"==t?(n.uesrData.realname=this.value,n.nameOff=!0):"qq"==t?n.uesrData.qq=this.value:"yy"==t&&(n.uesrData.yy=this.value)}})}),i.on("click","p",function(){var e=t(this),i=e.index();0==i?(e.find("i").addClass("icon_nan_act"),e.siblings("p").find("i").removeClass("icon_nv_act"),n.uesrData.gender=1):(e.find("i").addClass("icon_nv_act"),e.siblings("p").find("i").removeClass("icon_nan_act"),n.uesrData.gender=2),t("#sexVal").val(i)});var a='<div class="select_ui"><div class="select_arrow"></div><div class="select_text_ui" style="min-width: 2.5em;">北京</div><select class="province" required="true" name="birthday_year"></select></div><div class="select_ui"><div class="select_arrow"></div><div class="select_text_ui" style="min-width: 2.5em;">西城</div><select class="city" required="true" name="birthday_year"></select></div>',o=t(".selectList");o.on("click",".dq",function(){{var e=t(this).parent();e.html()}e.html(a);var i,s,l="/static/user/area.json",r=o.find(".province"),c=o.find(".city"),d=function(){t.each(i,function(e,t){s+="<option value='"+t.p+"'>"+t.p+"</option>"}),r.html(s),r.siblings(".select_text_ui").html(r.val()),u()},u=function(){s="";var e=r.get(0).selectedIndex;t.each(i[e].c,function(e,t){s+="<option value='"+t+"'>"+t+"</option>"}),c.html(s),c.siblings(".select_text_ui").html(c.val())};r.change(function(){r.siblings(".select_text_ui").html(r.val()),u(),n.uesrData.address=r.val()+"-"+c.val()}),c.change(function(){c.siblings(".select_text_ui").html(c.val()),n.uesrData.address=r.val()+"-"+c.val()}),t.getJSON(l,function(e){i=e,d()})}),this.upImg(),this.changeUserData()},upImg:function(){var e=this;t.fn.extend({uploadPreview:function(e){var i=this,n=t(this);e=jQuery.extend({Img:"imghead",Width:120,Height:120,ImgType:["gif","jpeg","jpg","bmp","png"]},e||{}),i.getObjectURL=function(e){var t=null;return void 0!=window.createObjectURL?t=window.createObjectURL(e):void 0!=window.URL?t=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},n.change(function(){if(this.value){if(!RegExp(".("+e.ImgType.join("|")+")$","i").test(this.value.toLowerCase()))return layer.msg("不支持该文件上传！",{time:2e3}),this.value="",!1;if((this.files[0].size/1024).toFixed(2)>=150)return void layer.msg("上传头像不能超过150KB！",{time:2500});if(t.browser.msie)try{t("#"+e.Img).attr("src",i.getObjectURL(this.files[0]))}catch(n){var a="",o=t("#"+e.Img),s=o.parent(".up_img")[0];i.select(),top!=self?window.parent.document.body.focus():i.blur(),a=document.selection.createRange().text,document.selection.empty(),o.hide(),o.parent(".up_img").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",width:e.Width+"px",height:e.Height+"px"}),s.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=a}else t("#"+e.Img).attr("src",i.getObjectURL(this.files[0])),t("#"+e.Img).css({width:e.Width,height:e.Height});e.Callback()}})}}),t("#fileImg").uploadPreview({Img:"imghead",Width:120,Height:120,Callback:function(){var i=/<[^>]*>/g;uploadForm=t("#uploadForm").attr("action","/upload?id_good="+e.allData.id_good),success=function(t){1==t.status&&(e.uesrData.profile=t.file_url,console.log(t.file_url))},t("#uploadForm").off().submit(),t("#iframe").off().load(function(){try{var e=t.parseJSON(this.contentWindow.document.body.innerHTML.replace(i,""));success(e)}catch(n){}})}})},eventFn:function(){var e=this;this.user_tabUl=t(".user_tabUl"),this.index=0,this.user_tabUl.on("click","li",function(){var i=t(this).index();window.location.hash="n="+i,e.changeHash()}),t("#a_dope").on("click",function(){window.location.hash="n=0&b=0",e.changeHash()}),t("#a_advise").on("click",function(){window.location.hash="n=0&b=1",e.changeHash()}),t("#edit").on("click",function(){window.location.hash="n=0",e.changeHash()}),localStorage.removeItem("n=0"),localStorage.removeItem("n=1"),localStorage.removeItem("b")},changeHash:function(){var i=new e.parseUri(window.location.href,"#"),n={n:i.n||"0",b:i.b,id:i.id||1},a=(window.location.hash.substring(1)||"n=0",this),o=t("#wrap_list");o.html(""),this.user_tabUl.find("li").eq(n.n).addClass("act").siblings().removeClass("act");var s={tab1:function(){var e=function(){function e(e){return e=e.replace(/\</g,"&lt;"),e=e.replace(/\>/g,"&gt;"),e=e.replace(/\n/g,"<br/>"),e=e.replace(/\[em_([0-9]*)\]/g,'<img src="/images/face/$1.gif" border="0" />')}1==n.b&&t("html,body").animate({scrollTop:400}),t(".emotion").qqFace({id:"facebox",assign:"saytext",path:"/images/face/"}),t(".sub_btn").click(function(){var i=t("#saytext").val();t("#show").html(e(i))})};return window.localStorage&&null!=localStorage.getItem("b")?(o.html(localStorage.getItem("b")),void e()):void o.load("/user/news1.html?100",function(i){localStorage.setItem("b",i),e();var n=t(".biaoqing").find("em"),a=2e3;t(".textarea").on("input propertychange",function(){var e=t(this).val().replace(/\s+/g,"").length;e>a?t(this).val(t(this).val().substring(0,a)):n.html(a-e)}).trigger("input").trigger("propertychange")})}};switch(n.n){case"0":if(n.b)s.tab1();else{if(window.localStorage&&null!=localStorage.getItem("n=0"))return o.html(localStorage.getItem("n=0")),void a.revise();o.load("/user/data_page.html?"+(new Date).getTime(),function(){a.getUserData(),a.revise()})}break;case"1":var l=function(){Fengs.use("940/user/course",function(e){var i={pageCount:5,current:1,backFn:function(){}};e.init(t(".tcdPageCode"),i)})};if(window.localStorage&&null!=localStorage.getItem("n=1"))return o.html(localStorage.getItem("n=1")),void l();o.load("/user/course1.html",function(e){localStorage.setItem("n=1",e),l()});break;case"2":var r=function(e){o.html(""),t.get("/noticeInfo?id="+e,function(e){var i=t.parseJSON(e);if(console.log(i),1==i.status){var n=i.notice,a=i.last,s=i.next,l='<div class="gonggao"><h1>'+n.title+"</h1><strong>亲爱的互联支付用户：</strong><p>"+n.content+'</p><div class="right">'+n.author+"<br>"+n.time+'</div><div class="left"><p>上一条：<a href="javascript:" class="last">'+(a.title?a.title:"没有了")+'</a></p><p>下一条：<a href="javascript:" class="next">'+(s.title?s.title:"没有了")+"</a></p></div></div>";o.html(l)}else o.html("服务器请求失败，请稍后再试！");o.off().on("click",".next",function(){s.title&&(r(s.id),t("body,html").scrollTop(0))}).on("click",".last",function(){a.title&&(r(a.id),t("body,html").scrollTop(0))})})};r(n.id)}},changeUserData:function(){var e=t.cookie("940_COM_USER"),i=t.cookie("940_COM_PASS"),n="";t(".modify_pass").on("click","a",function(){layer.open({type:1,title:"修改登录密码",area:["500px","290px"],shadeClose:!1,moveType:1,content:function(){if(!n){var e=t("#modify_pass");n=e.html(),e.remove()}return n}(),success:function(){r.modify_pass()},end:function(){t(document).off("keydown")}})});var a="";t(".bind_phone").on("click","a",function(){layer.open({type:1,title:"绑定手机",area:["500px","250px"],shadeClose:!1,moveType:1,content:function(){if(!a){var e=t("#bind_phone");a=e.html(),e.remove()}return a}(),success:function(){r.bind_phone()},end:function(){t(document).off("keydown")}})});var o="";t(".un_phone").on("click","a",function(){layer.open({type:1,title:"解绑手机",area:["500px","250px"],shadeClose:!1,moveType:1,content:function(){if(!o){var e=t("#un_phone");o=e.html(),e.remove()}return o}(),success:function(){r.un_phone()},end:function(){t(document).off("keydown")}})});var s="";t(".li_name").on("click",".modify_name a",function(){return t(".bind_phone").is(":hidden")?void layer.open({type:1,title:"修改姓名",area:["500px","300px"],shadeClose:!1,moveType:1,content:function(){if(!s){var e=t("#modify_name");s=e.html(),e.remove()}return s}(),success:function(){r.modify_name()},end:function(){t(document).off("keydown")}}):void layer.msg("请先绑定手机号码！",{time:2e3})});var l=this;t("#saveUserInfo").click(function(){l.uesrData.user_name=e,l.uesrData.password=i,l.nameOff&&layer.msg("请填写姓名！",{time:2e3}),layer.load(),t.post("/saveUserInfo",l.uesrData,function(e){var i=t.parseJSON(e);layer.closeAll("loading"),console.log(i.sududa),1==i.sududa.status&&(layer.msg("资料修改成功！",{icon:1}),setTimeout(function(){window.location.reload()},1500))}),console.log(l.uesrData)});var r={modify_pass:function(){var n=t(".wrapPass"),a=n.find("li:eq(0)").find("input").focus(),o=n.find("li:eq(1)").find("input"),s=n.find("li:eq(2)").find("input"),l=t(".pass_but");l.click(function(){""==a.val()?(layer.msg("请输入旧密码！",{time:1500}),a.focus()):""==o.val()?(layer.msg("请输入新密码！",{time:1500}),o.focus()):s.val()!=o.val()?(layer.msg("两次密码不一致！",{time:1500}),s.focus()):o.val().length<6||o.val().length>12?layer.msg("新密码长度为6~12位！",{time:2e3}):a.val()!=i?layer.msg("登录密码错误！",{time:1500}):(layer.load(),t.post("/updatePassword",{user_name:e,new_password:o.val(),password:i},function(e){var i=t.parseJSON(e);layer.closeAll("loading"),1==i.status?(layer.msg("密码修改成功！",{icon:1}),t.cookie("940_COM_PASS",o.val(),{path:"/"}),setTimeout(function(){window.location.reload()},1500)):layer.msg("服务器出错，请稍候再试！",{time:1500})}))}),t(document).keydown(function(e){13==e.keyCode&&l.trigger("click")})},un_phone:function(){var n=t(".un_but"),a=t(".un_code"),o=60;n.click(function(){if(60==o){{t(this).siblings("span").data("phone")}layer.load(),t.post("/getPhoneCode",{user_name:e,password:i},function(e){layer.closeAll("loading");var i=t.parseJSON(e);if(1==i.status){n.val(o+"后可重新发送");var a=setInterval(function(){o--,n.val(o+"后可重新发送"),1==o&&(clearInterval(a),o=60,n.val("点此获取验证码"))},1e3)}else layer.msg("发送失败，请稍后再试！",{time:1500})})}});var s=t(".unBut");s.click(function(){return""==a.val()?(layer.msg("请输入验证码！",{time:1500}),void a.focus()):(layer.load(),void t.post("/unBindPhone",{user_name:e,code:a.val()},function(e){var i=t.parseJSON(e);layer.closeAll("loading"),1==i.status?(layer.msg("解绑成功！",{icon:1}),setTimeout(function(){window.location.reload()},1500)):layer.msg("验证码有误！",{time:1500})}))}),t(document).keydown(function(e){13==e.keyCode&&s.trigger("click")})},bind_phone:function(){var n=t(".bind_but"),a=t(".bind_code"),o=60,s=n.siblings("span").find("input").focus(),l=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;n.click(function(){60==o&&(l.test(s.val())?(layer.load(),t.post("/getPhoneCode",{user_name:e,password:i,phone:s.val()},function(e){layer.closeAll("loading");var i=t.parseJSON(e);if(1==i.status){n.val(o+"后可重新发送");var a=setInterval(function(){o--,n.val(o+"后可重新发送"),1==o&&(clearInterval(a),o=60,n.val("点此获取验证码"))},1e3)}else layer.msg("发送失败，请稍后再试！",{time:1500})})):(layer.msg("手机号有误！",{time:1500}),s.focus()))});var r=t(".bindBut");r.click(function(){return l.test(s.val())?""==a.val()?(layer.msg("请输入验证码！",{time:1500}),void a.focus()):(layer.load(),void t.post("/bindPhone",{user_name:e,code:a.val(),phone:s.val()},function(e){var i=t.parseJSON(e);layer.closeAll("loading"),1==i.status?(layer.msg("绑定成功！",{icon:1}),setTimeout(function(){window.location.reload()},1500)):layer.msg("验证码有误！",{time:1500})})):(layer.msg("手机号有误！",{time:1500}),void s.focus())}),t(document).keydown(function(e){13==e.keyCode&&r.trigger("click")})},modify_name:function(){var n=t(".mod_name").focus(),a=t(".name_but"),o=t(".name_code"),s=60;a.click(function(){if(60==s){if(n.val().length<1)return layer.msg("请输入姓名！",{time:1500}),void n.focus();{t(this).siblings("span").data("phone")}layer.load(),t.post("/getPhoneCode",{user_name:e,password:i},function(e){layer.closeAll("loading");var i=t.parseJSON(e);if(1==i.status){a.val(s+"后可重新发送");var n=setInterval(function(){s--,a.val(s+"后可重新发送"),1==s&&(clearInterval(n),s=60,a.val("点此获取验证码"))},1e3)}else layer.msg("发送失败，请稍后再试！",{time:1500})})}});var l=t(".nameBut");l.click(function(){return""==n.val()?void layer.msg("请输入姓名！",{time:1500}):""==o.val()?void layer.msg("请输入验证码！",{time:1500}):(layer.load(),void t.post("/updateRealName",{user_name:e,code:o.val(),new_name:n.val()},function(e){var i=t.parseJSON(e);layer.closeAll("loading"),1==i.sududa.status?(layer.msg("修改成功！",{icon:1}),setTimeout(function(){window.location.reload()},1500)):layer.msg("验证码有误！",{time:1500})}))}),t(document).keydown(function(e){13==e.keyCode&&l.trigger("click")})},code:function(){}}},getUserData:function(){function e(e){return isNaN(parseInt(e))?void 0:e.substring(0,3)+"****"+e.substring(7,11)}var i=this,n=t.cookie("940_COM_USER"),a=t.cookie("940_COM_PASS"),o=t("#edit_ul"),s=o.find(".li_email"),l=o.find(".li_name"),r=o.find(".li_sex"),c=o.find(".li_phone"),d=o.find(".li_qq"),u=o.find(".li_yy"),m=o.find(".li_area"),f=(o.find(".li_url"),t(".user_info p")),h=t(".user_ul li"),g=t("#acc_data"),v=t("#acc_grade"),p=t("#u_name"),_=t(".user_dl dt img"),y=t("#imghead");t.post("/userInfo?user_name="+n+"&password="+a,function(o){var w=t.parseJSON(o),b=0;console.log(w),-9!=w.status&&(i.uesrData={user_name:n,password:a,qq:w.q,yy:w.yy,gender:w.s,profile:w.im,address:w.a},i.allData={user_name:n,password:a,qq:w.q,yy:"1",gender:w.s,profile:"",address:w.a,id_good:w.o},2==w.s?_.attr("src",w.im?"/"+w.im:"/images/user/nv_pic.png"):_.attr("src",w.im?"/"+w.im:"/images/user/nan_pic.png"),2==w.s?y.attr("src",w.im?"/"+w.im:"/images/user/up_give_nv.png"):y.attr("src",w.im?"/"+w.im:"/images/user/up_give_nan.png"),w.r&&(b+=14),(1==w.s||2==w.s)&&(b+=14),w.z&&(b+=14),w.q&&(b+=14),w.yy&&(b+=14),w.a&&(b+=14),w.im&&(b+=14),b>84&&(b=100),g.find("font").html(b+"%"),g.find("span i").css({width:b+"%"}),f.eq(0).html(w.u),f.eq(1).html("学员："+w.r),f.eq(2).html("编号："+w.o),h.eq(0).find("span").html(e(w.z)),h.eq(1).find("span").html(w.q),s.find("i").html(w.u),l.find("i").html(function(){var e=t(this).parents(".item");return w.r?(e.addClass("modify_name"),p.find("i").html("学员："+w.r),w.r):(e.addClass("revise_inp"),t(this).css("color","#999").siblings("a").html("（填写）"),p.find("i").html("学员：940"),"您还未填写姓名")}),1==w.s?r.find("p:eq(0) i").addClass("icon_nan_act"):2==w.s&&r.find("p:eq(1) i").addClass("icon_nv_act"),isNaN(parseInt(w.z))?c.find(".item").eq(1).show().siblings(".item").hide():(c.find(".item").eq(0).show().find("i").html(e(w.z)),t(".wrapPhone .m span").html(e(w.z)).attr("data-phone",w.z),v.find(".a_span i").addClass("yellow"),v.find("font").html("高")),d.find("i").html(function(){return w.q?w.q:(t(this).css("color","#999").siblings("a").html("（填写）"),"还未填写QQ")}),u.find("i").html(function(){return w.yy?w.yy:(t(this).css("color","#999").siblings("a").html("（填写）"),"还未填写yy")}),m.find("i").html(function(){return w.a?w.a:(t(this).css("color","#999").siblings("a").html("（选择）"),"还未选择地区")}),localStorage.setItem("n=0",t("#wrap_list").html()))})}}},["940/user/qqFace","940/utils/layer","jquery/cookie"]);